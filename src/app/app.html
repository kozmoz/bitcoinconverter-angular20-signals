<!-- Header bar -->
<div class="bg-primary text-white py-3 mb-4">
  <div class="container">
    <h1 class="h3 mb-0">Angular 21 Bitcoin Converter</h1>
    <p class="mb-0 small opacity-75">Live BTC price via CoinGecko</p>
  </div>
</div>

<div class="container mb-5">
  <div class="row g-4 align-items-start">
    <!-- Left: Form -->
    <div class="col-12 col-lg-6">

      <div class="mb-3 row">
        <label class="col-sm-2 col-form-label" for="currency">Currency</label>
        <div class="col-sm-10">
          <select id="currency" class="form-select w-auto" [(ngModel)]="currency"
                  [disabled]="priceEur() === null || priceUsd() === null">
            <option value="eur">EUR</option>
            <option value="usd">USD</option>
          </select>
        </div>
      </div>

      <div class="mb-3 row">
        <label class="col-sm-2 col-form-label d-block" for="dir-btc-to-fiat">Direction</label>
        <div class="col-sm-10">
          <div class="form-check form-check">
            <input class="form-check-input" type="radio" id="dir-btc-to-fiat" name="direction"
                   [value]="'btc-to-fiat'" [(ngModel)]="direction"
                   [disabled]="priceEur() === null || priceUsd() === null">
            <label class="form-check-label" for="dir-btc-to-fiat">
              BTC → {{ currency() === 'eur' ? 'Euro' : 'Dollar' }}
            </label>
          </div>
          <div class="form-check form-check">
            <input class="form-check-input" type="radio" id="dir-fiat-to-btc" name="direction"
                   [value]="'fiat-to-btc'" [(ngModel)]="direction"
                   [disabled]="priceEur() === null || priceUsd() === null">
            <label class="form-check-label" for="dir-fiat-to-btc">
              {{ currency() === 'eur' ? 'Euro' : 'Dollar' }} → BTC
            </label>
          </div>
        </div>
      </div>

      <div class="mb-3 row">
        <label class="col-sm-2 col-form-label" for="amount">Amount</label>
        <div class="col-sm-10">
          <div class="input-group" style="width: 20em;">
            <span class="input-group-text">
              {{ (direction() === 'btc-to-fiat') ? 'BTC' : (currency() === 'eur' ? 'EUR' : 'USD') }}
            </span>
            <input id="amount" class="form-control" type="number"
                   [attr.step]="direction() === 'btc-to-fiat' ? '0.000001' : '1'" min="0" [(ngModel)]="amount"
                   [disabled]="priceEur() === null || priceUsd() === null"/>
          </div>
          <div class="form-text">The amount that is used for the calculations.</div>
        </div>
      </div>
    </div>

    <!-- Right: Rate Panel -->
    <div class="col-12 col-lg-6">

      @let eur = priceEur();
      @let usd = priceUsd();

      <div class="border border-2 border-primary rounded-4 p-4">
        <div class="display-6 fw-semibold text-center mb-3">

          @if (eur === 0 || usd === 0) {
            <div class="text-muted">Loading current rate…</div>
          } @else {

            @if (direction() === 'fiat-to-btc') {
              @if (currency() === 'eur') {
                {{ amount() ?? 0 | currency:'EUR':'symbol':'1.2-2' }}
                ≈ <strong>{{ (amount() ?? 0) / eur | number:'1.8-8' }}&nbsp;BTC</strong>
              }
              @if (currency() === 'usd') {
                {{ amount() ?? 0 | currency:'USD':'symbol':'1.2-2' }}
                ≈ <strong>{{ (amount() ?? 0) / usd | number:'1.8-8' }}&nbsp;BTC</strong>
              }
            }

            @if (direction() === 'btc-to-fiat') {
              {{ amount() ?? 0 | number:'1.8-8' }}&nbsp;BTC
              @if (currency() === 'eur') {
                ≈ <strong>{{ (amount() ?? 0) * eur | currency:'EUR':'symbol':'1.2-2' }}</strong>
              }
              @if (currency() === 'usd') {
                ≈ <strong>{{ (amount() ?? 0) * usd | currency:'USD':'symbol':'1.2-2' }}</strong>
              }
            }

          }
        </div>
        <div class="text-center text-muted mb-2">The exchange rate updates every minute.</div>

        <div class="text-center text-muted" style="position: relative;">

          @if (loadingPriceEur() || loadingPriceUsd()) {
            <div class="text-center" style="position: absolute; right: 0; top: 0;">
              <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Loading...</span>
              </div>
            </div>
          }

          Last EUR update at: <strong>{{ lastUpdatedEur() ? (lastUpdatedEur() | date:'HH:mm') : '-' }}</strong><br/>
          Last USD update at: <strong>{{ lastUpdatedUsd() ? (lastUpdatedUsd() | date:'HH:mm') : '-' }}</strong><br/>

          @if (eur > 0) {
            1 BTC = {{ eur | currency:'EUR':'symbol':'1.2-2' }}
          }<br/>
          @if (usd > 0) {
            1 BTC = {{ usd | currency:'USD':'symbol':'1.2-2' }}
          }
        </div>
      </div>
    </div>
  </div>

  <div class="mt-4">
    @if (errorEur()) {
      <div class="alert alert-danger" role="alert">{{ errorEur() }}</div>
    }
    @if (errorUsd()) {
      <div class="alert alert-danger" role="alert">{{ errorUsd() }}</div>
    }
  </div>
</div>
